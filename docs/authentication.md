# Football Canvas èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†ã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

Football Canvasã¯ã€Supabaseã‚’ä½¿ç”¨ã—ãŸèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã—ã¦ãŠã‚Šã€æœªèªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²ãã€å€‹äººã®ãƒ—ãƒ¬ã‚¤ãƒ‡ãƒ¼ã‚¿ã‚’ä¿è­·ã—ã¾ã™ã€‚

> **ğŸ“‹ æ³¨æ„**: èªè¨¼æ©Ÿèƒ½ã®åˆæœŸè¨­å®šã«ã¤ã„ã¦ã¯ã€[AUTH_SETUP.md](../AUTH_SETUP.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€**ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†ã¨æ‰¿èªæ©Ÿèƒ½**ã«ç‰¹åŒ–ã—ãŸå†…å®¹ã‚’æ‰±ã„ã¾ã™ã€‚

## èªè¨¼æ–¹å¼

### 1. ãƒ¡ãƒ¼ãƒ«ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼

- **ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—**: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
- **ã‚µã‚¤ãƒ³ã‚¤ãƒ³**: æ—¢å­˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ãƒ­ã‚°ã‚¤ãƒ³
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¦ä»¶**: 6æ–‡å­—ä»¥ä¸Š

### 2. ã‚½ãƒ¼ã‚·ãƒ£ãƒ«èªè¨¼

- **Google OAuth**: Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ãƒ­ã‚°ã‚¤ãƒ³
- **GitHub OAuth**: GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ãƒ­ã‚°ã‚¤ãƒ³

## ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæœ‰åŠ¹åŒ–ãƒ•ãƒ­ãƒ¼

### ç¾åœ¨ã®å®Ÿè£…ï¼ˆãƒ¡ãƒ¼ãƒ«ç¢ºèªï¼‰

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²**
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒ•ã‚©ãƒ¼ãƒ ã§æƒ…å ±ã‚’å…¥åŠ›
   - Supabaseã«æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã‚‹

2. **ç¢ºèªãƒ¡ãƒ¼ãƒ«é€ä¿¡**
   - Supabaseã‹ã‚‰ç¢ºèªãƒ¡ãƒ¼ãƒ«ãŒè‡ªå‹•é€ä¿¡ã•ã‚Œã‚‹
   - ãƒ¡ãƒ¼ãƒ«å†…ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæœ‰åŠ¹åŒ–

3. **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæœ‰åŠ¹åŒ–**
   - ãƒ¡ãƒ¼ãƒ«ç¢ºèªå¾Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å³åº§ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

### ãƒ¡ãƒ¼ãƒ«ç¢ºèªã®ä»•çµ„ã¿

```typescript
// src/contexts/AuthContext.tsx
const signUp = async (email: string, password: string) => {
  const { error } = await supabase.auth.signUp({
    email,
    password,
    options: {
      // ãƒ¡ãƒ¼ãƒ«èªè¨¼å®Œäº†å¾Œã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆ
      emailRedirectTo: `${window.location.origin}/auth/callback`
    }
  })
  return { error }
}
```

## ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†

### Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã®ç®¡ç†

ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è¨±å¯ãƒ»ä¸è¨±å¯ã¯ã€Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§è¡Œã„ã¾ã™ï¼š

#### ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•
1. [Supabase Dashboard](https://supabase.com/dashboard)ã«ãƒ­ã‚°ã‚¤ãƒ³
2. è©²å½“ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆfootball-canvas-authï¼‰ã‚’é¸æŠ
3. å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã€ŒAuthenticationã€â†’ã€ŒUsersã€ã‚’é¸æŠ

#### ç®¡ç†å¯èƒ½ãªæ“ä½œ

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§è¡¨ç¤º**
   - ç™»éŒ²æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¸€è¦§è¡¨ç¤º
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ç™»éŒ²æ—¥æ™‚ã€æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³æ—¥æ™‚ã‚’ç¢ºèª
   - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç¢ºèªçŠ¶æ…‹ï¼ˆConfirmed/Unconfirmedï¼‰ã‚’ç¢ºèª

2. **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨±å¯ãƒ»ä¸è¨±å¯ç®¡ç†**
   
   **âœ… è¨±å¯ï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆæœ‰åŠ¹åŒ–ï¼‰**
   - **ãƒ¡ãƒ¼ãƒ«ç¢ºèªæ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼**: è‡ªå‹•çš„ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
   - **ãƒ¡ãƒ¼ãƒ«æœªç¢ºèªãƒ¦ãƒ¼ã‚¶ãƒ¼**: ç®¡ç†è€…ãŒãƒ¡ãƒ¼ãƒ«ç¢ºèªã‚’ä»£è¡Œå¯èƒ½
     - ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ç”»é¢ã§ã€ŒConfirm emailã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   
   **âŒ ä¸è¨±å¯ï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆç„¡åŠ¹åŒ–ï¼‰**
   - **ä¸€æ™‚åœæ­¢**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ–ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã«ã™ã‚‹
     - ã€ŒBlock userã€ãƒœã‚¿ãƒ³ã§ã‚¢ã‚¯ã‚»ã‚¹åœæ­¢
     - å¿…è¦ã«å¿œã˜ã¦ã€ŒUnblock userã€ã§å¾©æ—§å¯èƒ½
   - **å®Œå…¨å‰Šé™¤**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æ°¸ä¹…å‰Šé™¤
     - ã€ŒDelete userã€ãƒœã‚¿ãƒ³ã§å®Œå…¨å‰Šé™¤ï¼ˆå¾©å…ƒä¸å¯ï¼‰

3. **ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ç®¡ç†**
   - **åŸºæœ¬æƒ…å ±**: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€IDã€ä½œæˆæ—¥æ™‚
   - **èªè¨¼çŠ¶æ…‹**: 
     - `email_confirmed_at`: ãƒ¡ãƒ¼ãƒ«ç¢ºèªæ—¥æ™‚
     - `last_sign_in_at`: æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³æ—¥æ™‚
     - `banned_until`: ãƒ–ãƒ­ãƒƒã‚¯è§£é™¤æ—¥æ™‚ï¼ˆãƒ–ãƒ­ãƒƒã‚¯ä¸­ã®å ´åˆï¼‰
   - **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç·¨é›†**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å±æ€§ã®è¿½åŠ ãƒ»å¤‰æ›´
   - **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ç¢ºèªãƒ»ç„¡åŠ¹åŒ–

### å®Ÿéš›ã®é‹ç”¨æ‰‹é †

#### æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰¿èªæ‰‹é †

1. **æ–°è¦ç™»éŒ²ã®é€šçŸ¥ç¢ºèª**
   - Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§å®šæœŸçš„ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’ãƒã‚§ãƒƒã‚¯
   - æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆUnconfirmedçŠ¶æ…‹ï¼‰ã‚’ç¢ºèª

2. **ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®æ¤œè¨¼**
   - ç™»éŒ²ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å¦¥å½“æ€§ç¢ºèª
   - å¿…è¦ã«å¿œã˜ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€£çµ¡ã‚’å–ã‚Šã€æœ¬äººç¢ºèª

3. **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæœ‰åŠ¹åŒ–**
   - **è‡ªå‹•æ‰¿èª**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¡ãƒ¼ãƒ«ç¢ºèªãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯
   - **æ‰‹å‹•æ‰¿èª**: ç®¡ç†è€…ãŒã€ŒConfirm emailã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

#### å•é¡Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¯¾å‡¦æ‰‹é †

1. **ä¸€æ™‚åœæ­¢**
   - ä¸é©åˆ‡ãªåˆ©ç”¨ãŒç–‘ã‚ã‚Œã‚‹å ´åˆ
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ç”»é¢â†’ã€ŒBlock userã€
   - ç†ç”±ã‚’ãƒ¡ãƒ¢ã¨ã—ã¦è¨˜éŒ²ï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ ï¼‰

2. **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå¾©æ—§**
   - å•é¡Œè§£æ±ºå¾Œã€ã€ŒUnblock userã€ã§å¾©æ—§
   - å¾©æ—§æ—¥æ™‚ã¨ç†ç”±ã‚’ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«è¨˜éŒ²

3. **å®Œå…¨å‰Šé™¤**
   - é‡å¤§ãªé•åã‚„æ‚ªæ„ã®ã‚ã‚‹åˆ©ç”¨ã®å ´åˆ
   - ã€ŒDelete userã€ã§æ°¸ä¹…å‰Šé™¤
   - å‰Šé™¤å‰ã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–å¾—

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰‹å‹•æ‰¿èªï¼ˆç¾åœ¨æœªå®Ÿè£…ï¼‰

ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯è‡ªå‹•æ‰¿èªï¼ˆãƒ¡ãƒ¼ãƒ«ç¢ºèªã®ã¿ï¼‰ã§ã™ãŒã€æ‰‹å‹•æ‰¿èªãŒå¿…è¦ãªå ´åˆã¯ä»¥ä¸‹ã®æ–¹æ³•ã§å®Ÿè£…å¯èƒ½ã§ã™ï¼š

**å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³1: ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã®ç®¡ç†**
```sql
-- users ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚«ãƒ©ãƒ è¿½åŠ 
ALTER TABLE auth.users 
ADD COLUMN IF NOT EXISTS raw_user_meta_data JSONB;

-- æ‰¿èªçŠ¶æ…‹ã‚’è¿½åŠ 
UPDATE auth.users 
SET raw_user_meta_data = 
  COALESCE(raw_user_meta_data, '{}'::jsonb) || 
  '{"approved": false}'::jsonb
WHERE id = 'user-id';
```

**å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³2: RLSï¼ˆRow Level Securityï¼‰ã§ã®åˆ¶å¾¡**
```sql
-- approved ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
CREATE POLICY "Approved users only" ON public.plays
FOR ALL USING (
  auth.jwt() ->> 'user_metadata' ->> 'approved' = 'true'
);
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š

### Row Level Security (RLS)

å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼š

```sql
-- ãƒ—ãƒ¬ã‚¤ãƒ†ãƒ¼ãƒ–ãƒ«ã®RLSè¨­å®šä¾‹
CREATE POLICY "Users can view own plays" ON public.plays
FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can create own plays" ON public.plays
FOR INSERT WITH CHECK (auth.uid() = user_id);
```

### ç’°å¢ƒå¤‰æ•°

èªè¨¼ã«å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã¯`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ï¼š

```env
VITE_SUPABASE_URL=your-supabase-url
VITE_SUPABASE_ANON_KEY=your-supabase-anon-key
```

## ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®èªè¨¼

### ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®èªè¨¼ãƒã‚¤ãƒ‘ã‚¹

E2Eãƒ†ã‚¹ãƒˆã‚„ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã§ã¯ã€`VITE_TEST_MODE=true`ã§èªè¨¼ã‚’ãƒã‚¤ãƒ‘ã‚¹ï¼š

```typescript
// src/components/Auth/PrivateRoute.tsx
const isTestMode = import.meta.env.VITE_TEST_MODE === 'true'
if (isTestMode) {
  return <>{children}</>
}
```

### ãƒ†ã‚¹ãƒˆç”¨ãƒ¢ãƒƒã‚¯ãƒ¦ãƒ¼ã‚¶ãƒ¼

```typescript
// test/utils/testUtils.tsx
export const mockUser = {
  id: 'test-user-id',
  email: 'test@example.com',
  // ... ãã®ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
}
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **ç¢ºèªãƒ¡ãƒ¼ãƒ«ãŒå±Šã‹ãªã„**
   - ã‚¹ãƒ‘ãƒ ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç¢ºèª
   - Supabaseã®ãƒ¡ãƒ¼ãƒ«è¨­å®šã‚’ç¢ºèª
   - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å…¥åŠ›ãƒŸã‚¹ãŒãªã„ã‹ç¢ºèª

2. **ãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„**
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å…¥åŠ›ãƒŸã‚¹
   - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã¾ã ç¢ºèªã•ã‚Œã¦ã„ãªã„
   - ãƒ–ãƒ©ã‚¦ã‚¶ã®cookieã‚„localStorageã‚’ã‚¯ãƒªã‚¢

3. **ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ­ã‚°ã‚¤ãƒ³ãŒå¤±æ•—ã™ã‚‹**
   - OAuthè¨­å®šã®ç¢ºèª
   - ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURLã®è¨­å®šç¢ºèª

### ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

```typescript
// èªè¨¼çŠ¶æ…‹ã®ç¢ºèª
supabase.auth.onAuthStateChange((event, session) => {
  console.log('èªè¨¼çŠ¶æ…‹å¤‰æ›´:', event, session)
})

// ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³å–å¾—
const { data: { session } } = await supabase.auth.getSession()
console.log('ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³:', session)
```

## ä»Šå¾Œã®æ‹¡å¼µ

### ç®¡ç†è€…æ‰¿èªæ©Ÿèƒ½ã®å®Ÿè£…æ¡ˆ

1. **ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä½œæˆ**
   - æœªæ‰¿èªãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§è¡¨ç¤º
   - æ‰¿èªãƒ»æ‹’å¦ãƒœã‚¿ãƒ³ã®å®Ÿè£…

2. **æ‰¿èªå¾…ã¡ç”»é¢**
   - æœªæ‰¿èªãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®å¾…æ©Ÿç”»é¢
   - æ‰¿èªçŠ¶æ³ã®é€šçŸ¥æ©Ÿèƒ½

3. **æ¨©é™ç®¡ç†**
   - ç®¡ç†è€…æ¨©é™ã®è¨­å®š
   - å½¹å‰²ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `src/contexts/AuthContext.tsx` - èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
- `src/components/Auth/` - èªè¨¼é–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `src/components/Auth/PrivateRoute.tsx` - èªè¨¼ä¿è­·ãƒ«ãƒ¼ãƒˆ
- `src/main.tsx` - ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
- `test/utils/testUtils.tsx` - ãƒ†ã‚¹ãƒˆç”¨èªè¨¼ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£